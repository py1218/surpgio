---
import { Image } from "astro:assets";
import { QUOTE, SITE_TITLE } from "@/consts";
---

<!-- Full‑page background -->
<div
  class="fixed top-0 -z-10 w-screen h-screen bg-cover bg-center tracking-wide md:block"
  style="background-image:url('/surpgio_background.png');"
></div>

<section
  id="hero"
  class="relative flex flex-col items-center justify-center w-full flex-1 min-h-[60vh] pt-4 pb-2 overflow-y-auto z-20"
>
  <div
    class="rounded shadow-lg flex items-center justify-center w-full max-w-[960px] aspect-video"
    style="background:#000;"
  >
    <!-- Game iframe → hidden until inside operating hours -->
    <iframe
      id="game-frame"
      src="/build_test/index.html"
      allow="fullscreen; autoplay"
      title="Sexy Unique RPG Web Demo"
      class="w-full h-full border-0 rounded"
      style="display:none;"
    ></iframe>

    <!-- Fallback text shown when game is offline -->
    <span id="game-message" class="text-3xl font-bold text-[#dfe6e9]">
      Coming Soon...
    </span>
  </div>
</section>

<script type="module">
  /**
   * Get current hour in Pacific Time (24‑h clock)
   */
  function getHourPT() {
    return Number(
      new Intl.DateTimeFormat("en-US", {
        timeZone: "America/Los_Angeles",
        hour: "numeric",
        hour12: false,
      }).format(new Date())
    );
  }

  function updateGameAvailability() {
    const msg  = document.getElementById("game-message");
    const game = document.getElementById("game-frame");
    if (!msg || !game) return;

    const hour = getHourPT();
    const isOpen = hour >= 1 && hour < 22; // 5 PM ≤ hour < 10 PM PT

    if (isOpen) {
      game.style.display = "block";
      msg.style.display  = "none";
    } else {
      game.style.display = "none";
      msg.textContent    = "Coming Soon...";
      msg.style.display  = "block";
    }
  }

  // Run immediately — works even if DOMContentLoaded already fired
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", updateGameAvailability);
  } else {
    updateGameAvailability();
  }

  // Re‑run when the tab regains focus (navigation without hard refresh)
  document.addEventListener("visibilitychange", () => {
    if (!document.hidden) updateGameAvailability();
  });

  // Optional: keep checking every minute so page flips automatically at 5 PM/10 PM
  setInterval(updateGameAvailability, 60_000);
</script>
