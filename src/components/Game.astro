---
import { Image } from "astro:assets";
import { QUOTE, SITE_TITLE } from "@/consts";
---

<!-- Full-page background image -->
<div
  class="fixed inset-0 -z-10 bg-cover bg-center tracking-wide md:block"
  style="background-image:url('/surpgio_background.png');"
></div>

<section
  id="game"
  class="relative flex flex-col items-center justify-center w-full flex-1 min-h-[60vh] pt-4 pb-2 overflow-y-auto z-20"
>
  <!-- â”€â”€ GAME WRAPPER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div
    id="game-container"
    class="rounded shadow-lg w-full max-w-[960px] aspect-video box-border"
  >
    <iframe
      src="/build_test/index.html"
      allow="fullscreen; autoplay"
      loading="lazy"
      title="Sexy Unique RPG Web Demo"
      class="w-full h-full border-0"
    ></iframe>
  </div>

  <!-- â”€â”€ CLOSED MESSAGE (desktop, outside hours) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div
    id="closed-message"
    class="hidden mt-6 text-center text-xl font-semibold text-white neon-pink"
  >
    Please come back during business hours (5&nbsp;â€“&nbsp;10 PM&nbsp;PT).
  </div>

  <!-- â”€â”€ MOBILE APP STORE MESSAGE (overrides hours) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div
    id="mobile-message"
    class="hidden mt-6 text-center text-xl font-semibold text-white neon-pink"
  >
    <p class="mb-3">Phones get the VIP treatment. Download the app to jump in.</p>
    <a
      href="https://apps.apple.com/app/id6751006344"
      target="_blank"
      rel="noopener"
      aria-label="Download Sexy Unique RPG on the App Store"
      class="inline-block"
    >
      <img
        src="/Download_on_App_Store/Black_lockup/SVG/Download_on_the_App_Store_Badge_US-UK_RGB_blk_092917.svg"
        alt="Download on the App Store"
        class="h-12 w-auto"
        loading="lazy"
      />
    </a>
  </div>
</section>

<!-- â”€â”€ VISIBILITY LOGIC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<script type="module">
  // Mobile detection (UA-based so desktop narrow windows aren't misclassified)
  const isMobile = /android|iphone|ipad|ipod|opera mini|iemobile|mobile/i.test(
    navigator.userAgent
  );

  // Returns true if the current time in America/Los_Angeles is 17:00â€“21:59
  function inBusinessHours() {
    const now = new Date();
    const ptHour = Number(
      new Intl.DateTimeFormat("en-US", {
        hour: "numeric",
        hour12: false,
        timeZone: "America/Los_Angeles",
      }).format(now)
    );
    return ptHour >= 17 && ptHour < 22;
  }

  const gameEl = document.getElementById("game-container");
  const closedEl = document.getElementById("closed-message");
  const mobileEl = document.getElementById("mobile-message");

  if (isMobile) {
    // ðŸ”’ Mobile override: show App Store, hide everything else
    gameEl.style.display = "none";
    closedEl.style.display = "none";
    mobileEl.style.display = "block";

    // Optional: stop the iframe from loading at all on mobile
    const iframe = gameEl.querySelector("iframe");
    if (iframe) iframe.removeAttribute("src");
  } else {
    // Desktop: respect business hours
    const showGame = inBusinessHours();
    gameEl.style.display = showGame ? "" : "none";
    closedEl.style.display = showGame ? "none" : "block";
    mobileEl.style.display = "none";
  }
</script>
